---
import Presentation from "../../components/Presentation.astro";
import Divider from "../../components/ui/Divider.astro";
import ListItem from "../../components/ui/ListItem.astro";
import Layout from "../../layouts/Layout.astro";
import { Code } from "astro-expressive-code/components";
import { Code as AstroCode } from "astro:components";

//#region CodeSnippets
// Task 1 — rollDie that PRINTS (void); main calls multiple times
const Task1 = `
import java.util.Scanner;

public class Program
{
    public static void main(String[] args)
    {
        System.out.println("--- CRAPS ---");
        // Call several times to verify randomness
        rollDie();
        rollDie();
        rollDie();
    }

    // Step 1: print the die result (no return yet)
    static void rollDie()
    {
        int die = (int)(Math.random() * 6) + 1;
        System.out.println("Rolled: " + die);
    }
}
`;

// Task 2 — modify rollDie to RETURN an int; main prints the value
const Task2 = `
import java.util.Scanner;

public class Program
{
    public static void main(String[] args)
    {
        System.out.println("--- CRAPS ---");

        int d1 = rollDie();
        int d2 = rollDie();
        System.out.println("You rolled: " + d1 + " and " + d2);
    }

    // Step 2: now return the value instead of printing
    static int rollDie()
    {
        return (int)(Math.random() * 6) + 1;
    }
}
`;

// Task 3 — rollDice uses rollDie() twice, prints breakdown, returns total
const Task3 = `
import java.util.Scanner;

public class Program
{
    public static void main(String[] args)
    {
        System.out.println("--- CRAPS ---");
        promptRoll();
        int total = rollDice();
        System.out.println("Total: " + total); // Test variable for correctness
    }

    static int rollDie()
    {
        return (int)(Math.random() * 6) + 1;
    }

    // Step 3: compose method to roll two dice
    static int rollDice()
    {
        int die1 = rollDie();
        int die2 = rollDie();
        int total = die1 + die2;
        System.out.println("You rolled " + die1 + " + " + die2 + " = " + total);
        return total;
    }

    // Roll dice input
    static void promptRoll()
    {
        Scanner input = new Scanner(System.in);
        System.out.print("Press Enter to roll...");
        input.nextLine(); // simple pause
    }
}
`;

// Task 4 — come-out roll logic; returns boolean (true=end of round)
// If not over, caller will set 'point'
const Task4 = `
import java.util.Scanner;

public class Program
{
    public static void main(String[] args)
    {
        System.out.println("--- CRAPS ---");
        int point = 0;

        promptRoll();
        int roll = rollDice();
        boolean roundOver = evaluateComeOutRoll(roll);

        if (!roundOver)
        {
            point = roll;
            System.out.println("The point is now " + point + ".");
            // Next task: loop while not over and resolve the point.
        }
    }

    static int rollDie()
    {
        return (int)(Math.random() * 6) + 1;
    }

    static int rollDice()
    {
        int d1 = rollDie();
        int d2 = rollDie();
        int total = d1 + d2;
        System.out.println("You rolled " + d1 + " + " + d2 + " = " + total);
        return total;
    }

    static void promptRoll()
    {
        Scanner input = new Scanner(System.in);
        System.out.print("Press Enter to roll...");
        input.nextLine(); // simple pause
    }

    // Step 4: come-out evaluation
    static boolean evaluateComeOutRoll(int roll)
    {
        if (roll == 7 || roll == 11)
        {
            System.out.println("Rolled a " + roll + "! You win!");
            return true;
        }
        else if (roll == 2 || roll == 3 || roll == 12)
        {
            System.out.println("Rolled a " + roll + ". You lose.");
            return true;
        }
        else
        {
            System.out.println("Rolled a " + roll + ".");
            return false;
        }
    }
}
`;

// Task 5 — add point resolution: evaluatePointRoll + loop until end
const Task5 = `
import java.util.Scanner;

public class Program
{
    public static void main(String[] args)
    {
        System.out.println("--- CRAPS ---");

        int point = 0;
        boolean gameOver;

        promptRoll();
        int roll = rollDice();
        gameOver = evaluateComeOutRoll(roll);

        if (!gameOver)
        {
            point = roll;
            System.out.println("The point is now " + point + ".");

            // Step 5: keep rolling until win (hit point) or lose (7)
            while (!gameOver)
            {
                promptRoll();
                roll = rollDice();
                gameOver = evaluatePointRoll(roll, point);
            }
        }

        System.out.println("Thanks for playing!");
    }

    static int rollDie()
    {
        return (int)(Math.random() * 6) + 1;
    }

    static int rollDice()
    {
        int d1 = rollDie();
        int d2 = rollDie();
        int total = d1 + d2;
        System.out.println("You rolled " + d1 + " + " + d2 + " = " + total);
        return total;
    }

    static void promptRoll()
    {
        Scanner input = new Scanner(System.in);
        System.out.print("Press Enter to roll...");
        input.nextLine(); // simple pause
    }

    static boolean evaluateComeOutRoll(int roll)
    {
        if (roll == 7 || roll == 11)
        {
            System.out.println("Rolled a " + roll + "! You win!");
            return true;
        }
        else if (roll == 2 || roll == 3 || roll == 12)
        {
            System.out.println("Rolled a " + roll + ". You lose.");
            return true;
        }
        else
        {
            System.out.println("Rolled a " + roll + ".");
            return false;
        }
    }

    // Step 5: resolve after point is set
    static boolean evaluatePointRoll(int roll, int point)
    {
        if (roll == point)
        {
            System.out.println("Rolled a " + roll + "! You win!");
            return true;
        }
        else if (roll == 7)
        {
            System.out.println("Rolled a 7. You lose.");
            return true;
        }
        else
        {
            System.out.println("Rolled a " + roll + ". Still shooting for " + point + ".");
            return false;
        }
    }
}
`;

// Sample output for the final task
const SampleOutput = `
--- CRAPS ---
Press Enter to roll...
You rolled 4 + 3 = 7
Rolled a 7! You win!
Thanks for playing!
`;
//#endregion
---

<Layout>
  <div class="container my-4">
    <div class="row justify-content-center">
      <div class="col-sm-12 col-md-10">
        <a href="/java-programming/" class="btn btn-sm btn-outline-light mb-3">
          <i class="si-arrow-left"></i> Back
        </a>

        <h1>Activity 3.3 Designing with Methods: Stepwise Refinement</h1>
        <Divider variant="8" classes="mb-4" />

        <!-- Introduction -->
        <h2>Introduction</h2>
        <Presentation>
          <section>
            <h3>Designing with Methods</h3>
            <h4 class="text-skynest-theme">Breaking Down Problems Step by Step</h4>
          </section>
          <section>
            <h4>What Is Stepwise Refinement?</h4>
            <p>
              Stepwise refinement is the process of starting with a broad goal
              and gradually dividing it into smaller, more manageable tasks.
            </p>
            <p>
              Each step adds more detail until your program is complete and
              ready to run.
            </p>
          </section>
          <section>
            <h4>Why Use Stepwise Refinement?</h4>
            <ul>
              <li class="fragment">
                <strong>Organization:</strong> Plan before coding. Avoid writing everything in <code>main()</code>.
              </li>
              <li class="fragment">
                <strong>Focus:</strong> Build and test one small part at a time.
              </li>
              <li class="fragment">
                <strong>Reusability:</strong> Each method can be reused or replaced later.
              </li>
              <li class="fragment">
                <strong>Debugging:</strong> When something breaks, you know exactly where to look.
              </li>
            </ul>
          </section>
          <section>
            <h4>Example of Refinement</h4>
            <p>
              Suppose we want to build a simple dice game. Instead of writing the whole game at once,
              we can break it down:
            </p>
            <ol>
              <li>Roll a single die</li>
              <li>Roll two dice and calculate the total</li>
              <li>Apply the game rules for a round</li>
              <li>Repeat rounds until the player quits</li>
            </ol>
            <p class="fragment">
              Each step becomes a <strong>method</strong>. Together, they form a complete game.
            </p>
          </section>
          <section>
            <h4>Our Goal</h4>
            <p>
              We'll design a simplified version of the dice game <strong>Craps</strong> using stepwise refinement.
            </p>
            <p>
              Each method will handle one small, focused task to make the code easier to test and read.
            </p>
          </section>
        </Presentation>

        <section id="objectives">
          <h3>Objectives</h3>
          <ul>
            <ListItem>Apply stepwise refinement to design a small game.</ListItem>
            <ListItem>Use parameters and return values to control program flow.</ListItem>
            <ListItem>Refactor working code into clean, reusable methods.</ListItem>
          </ul>
        </section>

        <Divider variant="8" classes="mb-4" />

        <section id="activity-tasks">
          <h2>Activity Tasks</h2>
          <ul>
            <ListItem variant="2">Create a new Java file named <span class="text-skynest-theme">CrapsGame</span>.</ListItem>
            <ListItem variant="2">Build and run after each step. Do not skip ahead.</ListItem>
          </ul>

          <!-- Task 1 -->
          <Divider variant="8" classes="my-4" />
          <h3><span class="text-skynest-theme">Task 1</span>: Roll a Single Die (print only)</h3>
          <ul>
            <ListItem variant="2">Implement <code>rollDie()</code> that prints the die result.</ListItem>
            <ListItem variant="2">Call it several times from <code>main()</code>.</ListItem>
          </ul>
          <Code code={Task1} frame="code" lang="java" title="Program.java" />

          <!-- Task 2 -->
          <Divider variant="8" classes="my-4" />
          <h3><span class="text-skynest-theme">Task 2</span>: Return Instead of Print</h3>
          <ul>
            <ListItem variant="2">Modify <code>rollDie()</code> to return the value.</ListItem>
            <ListItem variant="2">Print in <code>main()</code> after the call.</ListItem>
          </ul>
          <Code code={Task2} frame="code" lang="java" title="Program.java" mark={[{range: "9-11"}, {range: "17"}]} />

          <!-- Task 3 -->
          <Divider variant="8" classes="my-4" />
          <h3><span class="text-skynest-theme">Task 3</span>: Roll Two Dice</h3>
          <ul>
            <ListItem variant="2">Create <code>rollDice()</code> that calls <code>rollDie()</code> twice, prints the breakdown, and returns the total.</ListItem>
            <ListItem variant="2">Create <code>promptRoll()</code> for user input.</ListItem>
          </ul>
          <Code code={Task3} frame="code" lang="java" title="Program.java" mark={[{range: "7-10"}, {range: "19-26"}, {range: "29-34"}]} />

          <!-- Task 4 -->
          <Divider variant="8" classes="my-4" />
          <h3><span class="text-skynest-theme">Task 4</span>: Come-Out Roll Rules</h3>
          <ul>
            <ListItem variant="2">Write <code>evaluateComeOutRoll(int roll)</code> to print the outcome and return whether the round is over.</ListItem>
            <ListItem variant="2">If the round continues, set <code>point = roll</code>.</ListItem>
          </ul>
          <Code code={Task4} frame="code" lang="java" title="Program.java" mark={[{range: "7-19"}, {range: "44-61"}]} collapse={["29-33", "38-40"]} />

          <!-- Task 5 -->
          <Divider variant="8" classes="my-4" />
          <h3><span class="text-skynest-theme">Task 5</span>: Resolve the Point</h3>
          <ul>
            <ListItem variant="2">Add <code>evaluatePointRoll(int roll, int point)</code> and loop until win/lose.</ListItem>
          </ul>
          <Code code={Task5} frame="code" lang="java" title="Program.java" mark={[{range: "7-30"}, {range: "74-91"}]} collapse={["40-44", "49-51", "56-70"]} />
        </section>

        <Divider variant="8" classes="my-4" />

        <section id="sample-output">
          <h2>Sample Output</h2>
          <Code code={SampleOutput} frame="terminal" lang="txt" showLineNumbers={false} title="Sample Output" />
        </section>

        <Divider variant="8" classes="my-4" />

        <section id="reflection">
          <h2>Reflection Questions</h2>
          <ol>
            <li>Which method did you write first, and why was that a good starting point?</li>
            <li>How did return values help you control the game flow?</li>
            <li>After refactoring, what does <code>main()</code> focus on now?</li>
          </ol>
        </section>

        <Divider variant="8" classes="my-4" />

        <section id="submission">
          <h2>Submission</h2>
          <p>Submit your completed <code>.java</code> file and reflection answers to the appropriate dropbox.</p>
          <h1 class="text-center mt-5 text-skynest-theme border border-primary">Activity Complete</h1>
        </section>
      </div>
    </div>
  </div>
</Layout>
